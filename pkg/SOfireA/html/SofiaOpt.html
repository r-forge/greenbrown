<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Optimize a SOFIA model using genetic optimization</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for SofiaOpt {SOfireA}"><tr><td>SofiaOpt {SOfireA}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Optimize a SOFIA model using genetic optimization</h2>

<h3>Description</h3>

<p>The function fits a SOFIA model to observations by estimating model parameters using <code><a href="Sofia.html">Sofia</a></code> genetic optimization. </p>


<h3>Usage</h3>

<pre>SofiaOpt(x, area = rep(1, nrow(x)), per.group = rep(FALSE, ncol(x)), 
    sofiapar = NULL, par.init = NULL, obs, unc = NULL, cost = NULL, 
    pop.size = 500, max.generations = 30, path = NULL, restart = 0, 
    nodes = 5, BFGSburnin = max.generations - 2, ...)</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>data.frame with independent variables</p>
</td></tr>
<tr valign="top"><td><code>area</code></td>
<td>
<p>a vector or data.frame/matrix with fractional coverage of grid cell area. If 'area' is a vector, it represents the maximal fractional burned area of a grid cell (e.g. the maximum vegetated area). If 'area' is a data.frame or matrix, it represents fractional coverage of groups (e.g. PFTs). Columns should represent groups and rows should be observations (grid cells and time steps). </p>
</td></tr>
<tr valign="top"><td><code>per.group</code></td>
<td>
<p>a boolean vector that indicates if a column in x acts per group (e.g. PFTs) </p>
</td></tr>
<tr valign="top"><td><code>sofiapar</code></td>
<td>
<p>object of class <code><a href="SofiaPar.html">SofiaPar</a></code> which is used for the fit. If NULL, the argument 'par.init' is used to create sofiapar using the function <code><a href="SofiaPar.html">SofiaPar</a></code></p>
</td></tr>
<tr valign="top"><td><code>par.init</code></td>
<td>
<p>matrix of inital parameters for optimization</p>
</td></tr>
<tr valign="top"><td><code>obs</code></td>
<td>
<p>a vector of observed values</p>
</td></tr>
<tr valign="top"><td><code>unc</code></td>
<td>
<p>vector of observation uncertainties, if NULL an uncertainty of 1 is is used for all observations</p>
</td></tr>
<tr valign="top"><td><code>cost</code></td>
<td>
<p>a function to compute the cost, if NULL SSE (sum of squared error) is used</p>
</td></tr>
<tr valign="top"><td><code>pop.size</code></td>
<td>
<p>population size, see <code><a href="../../rgenoud/html/genoud.html">genoud</a></code></p>
</td></tr>
<tr valign="top"><td><code>max.generations</code></td>
<td>
<p>maximum number of generations, see <code><a href="../../rgenoud/html/genoud.html">genoud</a></code></p>
</td></tr>
<tr valign="top"><td><code>path</code></td>
<td>
<p>directory for optimization results</p>
</td></tr>
<tr valign="top"><td><code>restart</code></td>
<td>
<p>restart: 0 = start with new optimization, 1 = start with best individuals from previous optimization in 'path', 2 = return results</p>
</td></tr>
<tr valign="top"><td><code>nodes</code></td>
<td>
<p>how many nodes to use for parallel executaion of genoud?</p>
</td></tr>
<tr valign="top"><td><code>BFGSburnin</code></td>
<td>
<p>The number of generations before the L-BFGS-B algorithm is first used, see <code><a href="../../rgenoud/html/genoud.html">genoud</a></code></p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>further arguments to <code><a href="../../rgenoud/html/genoud.html">genoud</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>No details.</p>


<h3>Value</h3>

<p>an object of class 'Sofia' which is actually a list.</p>


<h3>Author(s)</h3>

<p>Matthias Forkel &lt;matthias.forkel@geo.tuwien.ac.at&gt; [aut, cre]</p>


<h3>References</h3>

<p>No reference.	</p>


<h3>See Also</h3>

<p><code><a href="Sofia.html">Sofia</a></code></p>


<h3>Examples</h3>

<pre>

# some example data
n &lt;- 500
sm &lt;- runif(n, 0, 100) # soil moisture
temp &lt;- rnorm(n, 12, 10) # temperature
tree &lt;- runif(n, 0, 1) # fractional tree cover
grass &lt;- 1 - tree # fractional grass cover
area &lt;- cbind(tree, grass)
x &lt;- cbind(sm, temp)

# create 'observations'
sofiapar &lt;- SofiaPar(colnames(x), colnames(area), per.group=c(TRUE, FALSE))
sofiapar$par &lt;- c(1, 1, 20, 2, 1, -0.2, -0.1, 13, 10) # actual parameters
sf &lt;- Sofia(x, area, per.group=c(TRUE, FALSE), sofiapar=sofiapar)
plot(sf) # fitted values vs. temperature
obs &lt;- sf$data$y # 'observations'

# re-estimate parameters: for a real optimization pop.size and max.generations should be increased 
setwd("~/tmp/")
par.init &lt;- sofiapar$par * 1.5 # some inital parameters for optimization
sfbest &lt;- SofiaOpt(x, area, per.group=c(TRUE, FALSE), obs=obs, sofiapar=sofiapar, par.init=par.init, pop.size=10, max.generations=10, BFGS=FALSE, restart=0, nodes=1) 
sfbest
plot(sfbest)

# plot iterations of optimization: set directory where optimization results are saved
files &lt;- list.files(pattern="SofiaOpt")
fit &lt;- ReadSofiaOpt(files)
plot(fit)
plot(fit, plot.objfct = c("IoA", "FV", "MEF"))

# compare retrieved with original parameters
sfbest$par$par / par.init

# compare retrieved vs. real
sim &lt;- sfbest$data$y
lim &lt;- range(c(sim, obs))
plot(obs, sim, ylim=lim, xlim=lim)
abline(0,1)
ObjFct(sim, obs)

# compare real and retrieved response functions
plot(sf$data$x.temp, sf$data$f.temp)
points(sfbest$data$x.temp, sfbest$data$f.temp, col="red")

plot(sf$data$x.sm, sf$data$f.sm.tree)
points(sfbest$data$x.sm, sfbest$data$f.sm.tree, col="red")

plot(sf$data$x.sm, sf$data$f.sm.grass)
points(sfbest$data$x.sm, sfbest$data$f.sm.grass, col="red")

</pre>

<hr /><div style="text-align: center;">[Package <em>SOfireA</em> version 1.0 <a href="00Index.html">Index</a>]</div>
</body></html>
